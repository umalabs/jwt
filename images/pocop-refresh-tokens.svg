<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1641" height="960"><desc>participant%20%22Client%22%20as%20client%0Aparticipant%20%22Authorization%20Server%20(AS)%22%20as%20AS%0A%0Abottomparticipants%0A%0Anote%20over%20client%2CAS%3AMAC%20%3D%20HMAC(K1%2C%20m1)%0Anote%20right%20of%20client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%5Cn%E2%80%A2%20client%20has%20a%20valid%20refresh%20token%20issued%20by%20the%20AS%0Anote%20right%20of%20AS%3AAS%3A%5Cn%20a)%20issues%20opaque%20refresh%20token%20and%20access%20token%20using%20high%20entropy%20nonce%20data%20strings%5Cn%20b)%20maps%20the%20corresponding%20client%20secret%20to%20the%20issued%20tokens%20and%20stores%20the%20token%20data%20in%20a%20database%0Aclient-%3Eclient%3A1.%20Client%3A%5Cn%E2%80%A2%20generates%20the%20pocop-jwt%20with%20a%20payload%20including%20the%20refresh%20token%2C%20issuer%20and%20a%20timestamp%20%0Anote%20right%20of%20client%3AThe%20pocop-jwt%20is%20generated%20as%3A%5Cnpocop-jwt%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20base64url(%7B%22typ%22%3A%22JWT%22%2C%22alg%22%3A%22HS256%22%7D)%5Cnpayload%20%3D%20base64url(%7B%22token%22%3Arefresh%20token%2C%22iss%22%3Aclient%20name%2C%22ts%22%3Atimestamp%7D)%5Cnsignature%20%3D%20base64url(HMAC-SHA256(K1%2C%20m1))%5Cnwhere%5Cnm1%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnK1%20%3D%20SHA256(client%20secret)%0Aclient-%3EAS%3A2.%20pocop-jwt%0Anote%20right%20of%20client%3AClient%20sends%20the%20destination%20pocop-jwt%20in%20the%20Authorization%20header%5Cnto%20authenticate%20itself%20to%20the%20AS%20token%20endpoint%0AAS-%3EAS%3A3.%20AS%3A%5Cn%20a)%20looks%20up%20the%20refresh%20token%20data%20using%20the%20token%20claim%20value%20from%20the%20pocop-jwt%2C%20and%20checks%20the%20token%20state%5Cn%20b)%20generates%20a%20pocop-jwt%20replica%20using%20the%20pocop-jwt%20payload%20data%2C%20token%20data%20and%20the%20corresponding%20client%20secret%5Cn%20c)%20compares%20the%20pocop-jwt%20replica%20signature%20with%20the%20pocop-jwt%20signature%2C%20they%20are%20equal%2C%5Cn%20%20%20%20%20the%20chronological%20record%20of%20all%20the%20possessors%20of%20the%20POCOP%20token%20and%20the%20changes%20have%20been%20verified%2C%5Cn%20%20%20%20%20the%20AS%20validates%20the%20ts%20(timestamp)%20claim%20value%20from%20the%20pocop-jwt%2C%20if%20valid%2C%5Cn%20%20%20%20%20the%20AS%20may%20generate%20and%20return%20a%20new%20refresh%20token%20and%20a%20new%20access%20token%0Aclient%3C-AS%3A4.%20refresh%20token%20and%20access%20token%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1641" height="960"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.149658982 50.815047804 L 45.149658982 907.282322364" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 767.6772109984063 50.815047804 L 767.6772109984063 907.282322364" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 10.253481456000003 L 82.759993364 10.253481456000003 L 82.759993364 50.815047804 L 7.5393246000000005 50.815047804 L 7.5393246000000005 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="23.899658982" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 658.0502063893555 10.253481456000003 L 877.3042156074571 10.253481456000003 L 877.3042156074571 50.815047804 L 658.0502063893555 50.815047804 L 658.0502063893555 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="674.4105407713555" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 907.282322364 L 82.759993364 907.282322364 L 82.759993364 947.8438887120001 L 7.5393246000000005 947.8438887120001 L 7.5393246000000005 907.282322364 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="23.899658982" y="932.765239512" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 658.0502063893555 907.282322364 L 877.3042156074571 907.282322364 L 877.3042156074571 947.8438887120001 L 658.0502063893555 947.8438887120001 L 658.0502063893555 907.282322364 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="674.4105407713555" y="932.765239512" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 31.578874701999997 80.97234620399999 L 767.6772109984063 80.97234620399999 L 781.2479952784063 94.54313048399999 L 781.2479952784063 115.653239364 L 31.578874701999997 115.653239364 L 31.578874701999997 80.97234620399999 M 767.6772109984063 80.97234620399999 L 767.6772109984063 94.54313048399999 L 781.2479952784063 94.54313048399999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="325.7050991137383" y="102.08245508399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">MAC = HMAC(K1, m1)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 45.149658982 170.69030894399998 L 52.688983582 170.69030894399998 M 52.688983582 138.271213164 L 600.021766671375 138.271213164 L 613.592550951375 151.841997444 L 613.592550951375 203.109404724 L 52.688983582 203.109404724 L 52.688983582 138.271213164 M 600.021766671375 138.271213164 L 600.021766671375 151.841997444 L 613.592550951375 151.841997444" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="159.38132204399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="174.45997124399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="189.53862044399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• client has a valid refresh token issued by the AS</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 767.6772109984063 258.146474304 L 775.2165355984063 258.146474304 M 775.2165355984063 225.727378524 L 1553.0826438830939 225.727378524 L 1566.6534281630938 239.298162804 L 1566.6534281630938 290.565570084 L 775.2165355984063 290.565570084 L 775.2165355984063 225.727378524 M 1553.0826438830939 225.727378524 L 1553.0826438830939 239.298162804 L 1566.6534281630938 239.298162804" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="796.3266444784063" y="246.83748740399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="796.3266444784063" y="261.916136604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) issues opaque refresh token and access token using high entropy nonce data strings</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="796.3266444784063" y="276.994785804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) maps the corresponding client secret to the issued tokens and stores the token data in a database</text></g><g><g><rect fill="white" stroke="none" x="62.992727202000005" y="313.183543884" width="70.64026346117187" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="62.992727202000005" y="328.26219308400005" width="699.4069565764063" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="65.254524582" y="326.75432816400007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="65.254524582" y="341.83297736400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• generates the pocop-jwt with a payload including the refresh token, issuer and a timestamp </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.149658982 347.864437044 L 105.46425578200001 347.864437044 L 105.46425578200001 367.466681004 L 57.56441349 367.466681004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(45.149658982,367.466681004) translate(-45.149658982,-367.466681004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 57.715199982 361.183910504 L 45.149658982 367.466681004 L 57.715199982 373.74945150400004 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 45.149658982 467.739698184 L 52.688983582 467.739698184 M 52.688983582 390.084654804 L 666.0717544643437 390.084654804 L 679.6425387443437 403.655439084 L 679.6425387443437 545.394741564 L 52.688983582 545.394741564 L 52.688983582 390.084654804 M 666.0717544643437 390.084654804 L 666.0717544643437 403.655439084 L 679.6425387443437 403.655439084" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="411.194763684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The pocop-jwt is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="426.273412884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">pocop-jwt = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="441.35206208399995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="456.4307112839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = base64url({"typ":"JWT","alg":"HS256"})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="471.5093604839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = base64url({"token":refresh token,"iss":client name,"ts":timestamp})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="486.58800968399987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url(HMAC-SHA256(K1, m1))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="501.66665888399984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="516.7453080839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">m1 = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="531.8239572839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">K1 = SHA256(client secret)</text></g><g><g><rect fill="white" stroke="none" x="358.91830402255664" y="568.012715364" width="94.99026193529296" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="361.18010140255666" y="581.583499644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. pocop-jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.149658982 587.614959324 L 755.2624564904063 587.614959324" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(767.6772109984063,587.614959324) translate(-767.6772109984063,-587.614959324)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 755.1116699984062 581.332188824 L 767.6772109984063 587.614959324 L 755.1116699984062 593.897729824 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 45.149658982 635.112704304 L 52.688983582 635.112704304 M 52.688983582 610.232933124 L 569.6884231655156 610.232933124 L 583.2592074455156 623.803717404 L 583.2592074455156 659.992475484 L 52.688983582 659.992475484 L 52.688983582 610.232933124 M 569.6884231655156 610.232933124 L 569.6884231655156 623.803717404 L 583.2592074455156 623.803717404" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="631.3430420039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client sends the destination pocop-jwt in the Authorization header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.79909246199998" y="646.4216912039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to authenticate itself to the AS token endpoint</text></g><g><g><rect fill="white" stroke="none" x="785.5202792184064" y="682.6104492840001" width="47.49026193529297" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="785.5202792184064" y="697.689098484" width="818.7236069670313" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="785.5202792184064" y="712.767747684" width="850.8235825529688" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="785.5202792184064" y="727.846396884" width="668.02359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="785.5202792184064" y="742.925046084" width="783.840245150625" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="785.5202792184064" y="758.003695284" width="585.3235825529688" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="785.5202792184064" y="773.0823444839999" width="596.9069565764063" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="787.7820765984063" y="696.1812335640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="787.7820765984063" y="711.259882764" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) looks up the refresh token data using the token claim value from the pocop-jwt, and checks the token state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="787.7820765984063" y="726.338531964" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) generates a pocop-jwt replica using the pocop-jwt payload data, token data and the corresponding client secret</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="787.7820765984063" y="741.417181164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> c) compares the pocop-jwt replica signature with the pocop-jwt signature, they are equal,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="787.7820765984063" y="756.495830364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the chronological record of all the possessors of the POCOP token and the changes have been verified,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="787.7820765984063" y="771.574479564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS validates the ts (timestamp) claim value from the pocop-jwt, if valid,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="787.7820765984063" y="786.6531287639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS may generate and return a new refresh token and a new access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 767.6772109984063 792.684588444 L 827.9918077984063 792.684588444 L 827.9918077984063 812.286832404 L 780.0919655064063 812.286832404" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(767.6772109984063,812.286832404) translate(-767.6772109984063,-812.286832404)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 780.2427519984063 806.0040619040001 L 767.6772109984063 812.286832404 L 780.2427519984063 818.569602904 Z"/></g></g><g><g><rect fill="white" stroke="none" x="280.1183047854961" y="834.904806204" width="252.59026040941407" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="282.3801021654961" y="848.475590484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. refresh token and access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 767.6772109984063 854.507050164 L 57.56441349 854.507050164" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(45.149658982,854.507050164) translate(-45.149658982,-854.507050164)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 57.715199982 848.224279664 L 45.149658982 854.507050164 L 57.715199982 860.789820664 Z"/></g></g></g></g></svg>