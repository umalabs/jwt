<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1538" height="1103"><desc>participant%20%22Client%22%20as%20client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22Authorization%20Server%20(AS)%22%20as%20AS%0A%0Abottomparticipants%0A%0Anote%20over%20client%2CAS%3AMAC%20%3D%20HMAC(K_client%2C%20m_client)%5CnMAC%20%3D%20HMAC(K_RS%2C%20HMAC(MAC%2C%20m_RS))%0Anote%20right%20of%20client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Anote%20right%20of%20RS%3ARS%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Aclient-%3EAS%3A1.%20authorization%20grant%0AAS-%3EAS%3A2.%20AS%3A%5Cn%20a)%20issues%20an%20opaque%20access%20token%20using%20a%20high%20entropy%20nonce%20data%20string%5Cn%20b)%20maps%20the%20corresponding%20client%20secrets%20to%20the%20issued%20token%20and%20stores%20the%20token%20data%20in%20a%20database%0Aclient%3C-AS%3A3.%20access%20token%0Aclient-%3Eclient%3A4.%20Client%3A%5Cn%E2%80%A2%20generates%20the%20pocop-jwt%20with%20a%20payload%20including%20the%20access%20token%2C%20issuer%20and%20a%20timestamp%20%0Anote%20right%20of%20client%3AThe%20pocop-jwt%20is%20generated%20as%3A%5Cnpocop-jwt%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20base64url%20encoded%20%7B%22typ%22%3A%22JWT%22%2C%22alg%22%3A%22HS256%22%7D%5Cnpayload%20%3D%20base64url%20encoded%20%7B%22token%22%3Aaccess%20token%2C%22iss%22%3Aclient%20name%2C%22ts%22%3Atimestamp%7D%5Cnsignature%20%3D%20base64url%20encoded%20HMAC-SHA256(K_client%2C%20m_client)%5Cnwhere%5Cnm_client%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnK_client%20%3D%20SHA256(client%20secret)%0Aclient-%3ERS%3A5.%20pocop-jwt%0ARS-%3ERS%3A6.%20RS%3A%5Cn%E2%80%A2%20generates%20the%20next%20pocop-jwt%20with%20a%20compound%20payload%0Anote%20right%20of%20RS%3A%E2%80%A2%20a%20new%20required%20claim%20%7B%22iss%22%3Aclient%20name%2C%22ts%22%3Atimestamp%7D%20must%20be%20added%20to%20the%20previous%20pocop-jwt%5Cn%20%20%20payload%20as%20a%20nested%20object%20to%20form%20a%20new%20compound%20payload%5Cn%E2%80%A2%20the%20nested%20object%20may%20contain%20additional%20optional%20claims%20e.g.%2C%20%22resource_id%22%2C%20%22resource_scopes%22%0Anote%20right%20of%20RS%3AThe%20pocop-jwt%20is%20generated%20as%3A%5Cnpocop-jwt%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20previous%20pocop-jwt%20header%5Cnpayload%20%3D%20base64url%20encoded%20%5Bprevious%20pocop-jwt%20payload(pocop-jwt%20payload)%5D%5Cnsignature%20%3D%20base64url%20encoded%20HMAC-SHA256(K_RS%2C%20HMAC-SHA256(MAC%2C%20m_RS))%5Cnwhere%5Cnpocop-jwt%20payload%20%3D%20%7B%22iss%22%3Aclient%20name%2C%22ts%22%3Atimestamp%7D%5Cnm_RS%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnK_RS%20%3D%20SHA256(client%20secret)%5CnMAC%20%3D%20base64url%20decoded%20previous%20pocop-jwt%20signature%0ARS-%3EAS%3A7.%20pocop-jwt%0Anote%20right%20of%20RS%3ARS%20sends%20the%20pocop-jwt%20in%20the%20Authorization%20header%5Cnto%20authenticate%20itself%20to%20the%20AS%20introspection%20endpoint%0AAS-%3EAS%3A8.%20AS%3A%5Cn%20a)%20looks%20up%20the%20access%20token%20data%20using%20the%20token%20claim%20value%20from%20the%20pocop-jwt%2C%20and%20checks%20the%20token%20state%5Cn%20b)%20generates%20a%20pocop-jwt%20replica%20using%20the%20pocop-jwt%20payload%20data%2C%20token%20data%20and%20corresponding%20client%20secrets%5Cn%20c)%20compares%20the%20pocop-jwt%20replica%20signature%20with%20the%20pocop-jwt%20signature%2C%20they%20are%20equal%2C%5Cn%20%20%20%20%20the%20chronological%20record%20of%20all%20the%20possessors%20of%20the%20POCOP%20token%20and%20the%20changes%20have%20been%20verified%2C%5Cn%20%20%20%20%20the%20AS%20validates%20the%20ts%20(timestamp)%20claim%20values%20from%20the%20pocop-jwt%2C%20if%20valid%2C%5Cn%20%20%20%20%20the%20AS%20may%20return%20the%20access%20token%20introspection%20response%0ARS%3C-AS%3A9.%20access%20token%20introspection%20response%0ARS-%3ERS%3A10.%20verifies%20the%20access%20token%20introspection%20response%2C%20if%20true%2C%5Cn%20%20%20the%20RS%20may%20return%20the%20protected%20resource%0Aclient%3C-RS%3A21.%20protected%20resource</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1538" height="1103"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 33.876698536 L 29.42477278182324 1068.2720336560003" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 488.02088940929724 33.876698536 L 488.02088940929724 1068.2720336560003" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 995.3701279457816 33.876698536 L 995.3701279457816 1068.2720336560003" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.026216399999999 6.835654304000002 L 53.82332916364648 6.835654304000002 L 53.82332916364648 33.876698536 L 5.026216399999999 33.876698536 L 5.026216399999999 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="15.933105987999998" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 427.63900134717613 6.835654304000002 L 548.4027774714183 6.835654304000002 L 548.4027774714183 33.876698536 L 427.63900134717613 33.876698536 L 427.63900134717613 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.54589093517615" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 925.2049032442562 6.835654304000002 L 1065.535352647307 6.835654304000002 L 1065.535352647307 33.876698536 L 925.2049032442562 33.876698536 L 925.2049032442562 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="936.1117928322562" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.026216399999999 1068.2720336560003 L 53.82332916364648 1068.2720336560003 L 53.82332916364648 1095.3130778880004 L 5.026216399999999 1095.3130778880004 L 5.026216399999999 1068.2720336560003 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="15.933105987999998" y="1085.260645088" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 427.63900134717613 1068.2720336560003 L 548.4027774714183 1068.2720336560003 L 548.4027774714183 1095.3130778880004 L 427.63900134717613 1095.3130778880004 L 427.63900134717613 1068.2720336560003 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.54589093517615" y="1085.260645088" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 925.2049032442562 1068.2720336560003 L 1065.535352647307 1068.2720336560003 L 1065.535352647307 1095.3130778880004 L 925.2049032442562 1095.3130778880004 L 925.2049032442562 1068.2720336560003 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="936.1117928322562" y="1085.260645088" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 20.37758326182324 53.98156413600001 L 995.3701279457817 53.98156413600001 L 1004.4173174657817 63.028753656000006 L 1004.4173174657817 87.15459237600001 L 20.37758326182324 87.15459237600001 L 20.37758326182324 53.98156413600001 M 995.3701279457817 53.98156413600001 L 995.3701279457817 63.028753656000006 L 1004.4173174657817 63.028753656000006" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="419.0724534155603" y="68.054970056" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">MAC = HMAC(K_client, m_client)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="419.0724534155603" y="78.10740285600001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">MAC = HMAC(K_RS, HMAC(MAC, m_RS))</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 118.81975569600002 L 34.45098918182324 118.81975569600002 M 34.45098918182324 102.23324157600001 L 383.1506176053388 102.23324157600001 L 392.19780712533884 111.28043109600002 L 392.19780712533884 135.40626981600002 L 34.45098918182324 135.40626981600002 L 34.45098918182324 102.23324157600001 M 383.1506176053388 102.23324157600001 L 383.1506176053388 111.28043109600002 L 392.19780712533884 111.28043109600002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="116.30664749600002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="126.35908029600003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 488.02088940929724 167.07143313600002 L 493.04710580929725 167.07143313600002 M 493.04710580929725 150.48491901600002 L 841.7467342328129 150.48491901600002 L 850.7939237528128 159.532108536 L 850.7939237528128 183.65794725600003 L 493.04710580929725 183.65794725600003 L 493.04710580929725 150.48491901600002 M 841.7467342328129 150.48491901600002 L 841.7467342328129 159.532108536 L 850.7939237528128 159.532108536" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="164.55832493600002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="174.610757736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><g><g><rect fill="white" stroke="none" x="460.06458468086305" y="198.73659645600003" width="104.66573136587891" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="461.572449600863" y="207.78378597600002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. authorization grant</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 211.80475909600003 L 987.0936249404483 211.80475909600003" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(995.3701279457816,211.80475909600003) translate(-995.3701279457816,-211.80475909600003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 986.9931006124483 207.61624542933336 L 995.3701279457816 211.80475909600003 L 986.9931006124483 215.9932727626667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1007.2655067591149" y="226.88340829600006" width="30.332397396762694" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1007.2655067591149" y="236.93584109600005" width="347.2990550353125" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1007.2655067591149" y="246.98827389600004" width="479.08241074820313" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1008.7733716791149" y="235.93059781600004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1008.7733716791149" y="245.98303061600004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) issues an opaque access token using a high entropy nonce data string</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1008.7733716791149" y="256.035463416" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) maps the corresponding client secrets to the issued token and stores the token data in a database</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 995.3701279457816 260.05643653600004 L 1035.5798591457817 260.05643653600004 L 1035.5798591457817 273.12459917600006 L 1003.646630951115 273.12459917600006" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(995.3701279457816,273.12459917600006) translate(-995.3701279457816,-273.12459917600006)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1003.747155279115 268.9360855093334 L 995.3701279457816 273.12459917600006 L 1003.747155279115 277.3131128426667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="474.71458620674196" y="288.20324837600003" width="75.3657283141211" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="476.22245112674193" y="297.25043789600005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 995.3701279457816 301.27141101600006 L 37.701275787156575 301.27141101600006" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(29.42477278182324,301.27141101600006) translate(-29.42477278182324,-301.27141101600006)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 37.801800115156574 297.0828973493334 L 29.42477278182324 301.27141101600006 L 37.801800115156574 305.4599246826667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="41.320151595156574" y="316.35006021600003" width="45.01572984" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="41.320151595156574" y="326.40249301600005" width="443.18238633414063" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="42.82801651515658" y="325.39724973600005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="42.82801651515658" y="335.44968253600007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• generates the pocop-jwt with a payload including the access token, issuer and a timestamp </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 339.470655656 L 69.63450398182324 339.470655656 L 69.63450398182324 352.53881829600004 L 37.701275787156575 352.53881829600004" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(29.42477278182324,352.53881829600004) translate(-29.42477278182324,-352.53881829600004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 37.801800115156574 348.3503046293334 L 29.42477278182324 352.53881829600004 L 37.801800115156574 356.7273319626667 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 419.38749641600003 L 34.45098918182324 419.38749641600003 M 34.45098918182324 367.617467496 L 462.4172802029951 367.617467496 L 471.4644697229951 376.66465701600004 L 471.4644697229951 471.15752533600005 L 34.45098918182324 471.15752533600005 L 34.45098918182324 367.617467496 M 462.4172802029951 367.617467496 L 462.4172802029951 376.66465701600004 L 471.4644697229951 376.66465701600004" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="381.69087341600004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The pocop-jwt is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="391.74330621600006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">pocop-jwt = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="401.7957390160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="411.8481718160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = base64url encoded {"typ":"JWT","alg":"HS256"}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="421.9006046160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = base64url encoded {"token":access token,"iss":client name,"ts":timestamp}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="431.95303741600014" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url encoded HMAC-SHA256(K_client, m_client)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="442.00547021600016" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="452.0579030160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">m_client = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="462.1103358160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">K_client = SHA256(client secret)</text></g><g><g><rect fill="white" stroke="none" x="228.48163258791377" y="486.236174536" width="60.48239701529297" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="229.98949750791377" y="495.28336405600004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. pocop-jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 499.30433717600005 L 479.7443864039639 499.30433717600005" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(488.02088940929724,499.30433717600005) translate(-488.02088940929724,-499.30433717600005)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 479.6438620759639 495.1158235093334 L 488.02088940929724 499.30433717600005 L 479.6438620759639 503.4928508426667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="499.9162682226306" y="514.3829863760001" width="30.432395870883788" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="499.9162682226306" y="524.4354191760001" width="272.74906724234376" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="501.4241331426306" y="523.4301758960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="501.4241331426306" y="533.4826086960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• generates the next pocop-jwt with a compound payload</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 488.02088940929724 537.5035818160001 L 528.2306206092973 537.5035818160001 L 528.2306206092973 550.571744456 L 496.29739241463056 550.571744456" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(488.02088940929724,550.571744456) translate(-488.02088940929724,-550.571744456)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 496.39791674263057 546.3832307893333 L 488.02088940929724 550.571744456 L 496.39791674263057 554.7602581226668 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 488.02088940929724 587.263124176 L 493.04710580929725 587.263124176 M 493.04710580929725 565.650393656 L 981.2967220257816 565.650393656 L 990.3439115457816 574.697583176 L 990.3439115457816 608.875854696 L 493.04710580929725 608.875854696 L 493.04710580929725 565.650393656 M 981.2967220257816 565.650393656 L 981.2967220257816 574.697583176 L 990.3439115457816 574.697583176" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="579.7237995760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• a new required claim {"iss":client name,"ts":timestamp} must be added to the previous pocop-jwt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="589.7762323760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   payload as a nested object to form a new compound payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="599.8286651760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the nested object may contain additional optional claims e.g., "resource_id", "resource_scopes"</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 488.02088940929724 685.7769656160001 L 493.04710580929725 685.7769656160001 M 493.04710580929725 623.954503896 L 895.3300472210941 623.954503896 L 904.3772367410941 633.001693416 L 904.3772367410941 747.5994273360001 L 493.04710580929725 747.5994273360001 L 493.04710580929725 623.954503896 M 895.3300472210941 623.954503896 L 895.3300472210941 633.001693416 L 904.3772367410941 633.001693416" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="638.0279098160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The pocop-jwt is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="648.0803426160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">pocop-jwt = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="658.1327754160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="668.1852082160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = previous pocop-jwt header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="678.2376410160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = base64url encoded [previous pocop-jwt payload(pocop-jwt payload)]</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="688.2900738160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url encoded HMAC-SHA256(K_RS, HMAC-SHA256(MAC, m_RS))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="698.3425066160003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="708.3949394160003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">pocop-jwt payload = {"iss":client name,"ts":timestamp}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="718.4473722160003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">m_RS = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="728.4998050160003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">K_RS = SHA256(client secret)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="738.5522378160003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">MAC = base64url decoded previous pocop-jwt signature</text></g><g><g><rect fill="white" stroke="none" x="711.454310169893" y="762.6780765360002" width="60.48239701529297" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="712.962175089893" y="771.7252660560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. pocop-jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 488.02088940929724 775.7462391760001 L 987.0936249404483 775.7462391760001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(995.3701279457816,775.7462391760001) translate(-995.3701279457816,-775.7462391760001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 986.9931006124483 771.5577255093334 L 995.3701279457816 775.7462391760001 L 986.9931006124483 779.9347528426669 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 488.02088940929724 807.4114024960002 L 493.04710580929725 807.4114024960002 M 493.04710580929725 790.8248883760001 L 763.5467220257816 790.8248883760001 L 772.5939115457816 799.8720778960001 L 772.5939115457816 823.9979166160001 L 493.04710580929725 823.9979166160001 L 493.04710580929725 790.8248883760001 M 763.5467220257816 790.8248883760001 L 763.5467220257816 799.8720778960001 L 772.5939115457816 799.8720778960001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="804.8982942960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS sends the pocop-jwt in the Authorization header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.1205117292973" y="814.9507270960003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to authenticate itself to the AS introspection endpoint</text></g><g><g><rect fill="white" stroke="none" x="1007.2655067591149" y="839.0765658160001" width="30.332397396762694" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1007.2655067591149" y="849.1289986160001" width="519.01572984" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1007.2655067591149" y="859.1814314160001" width="527.3157176329687" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1007.2655067591149" y="869.2338642160001" width="424.58241074820313" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1007.2655067591149" y="879.2862970160002" width="498.2324046446875" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1007.2655067591149" y="889.3387298160002" width="376.8490733458594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="1007.2655067591149" y="899.3911626160002" width="294.18238633414063" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1008.7733716791149" y="848.1237553360002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1008.7733716791149" y="858.1761881360002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) looks up the access token data using the token claim value from the pocop-jwt, and checks the token state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1008.7733716791149" y="868.2286209360002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) generates a pocop-jwt replica using the pocop-jwt payload data, token data and corresponding client secrets</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1008.7733716791149" y="878.2810537360002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> c) compares the pocop-jwt replica signature with the pocop-jwt signature, they are equal,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1008.7733716791149" y="888.3334865360002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the chronological record of all the possessors of the POCOP token and the changes have been verified,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1008.7733716791149" y="898.3859193360003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS validates the ts (timestamp) claim values from the pocop-jwt, if valid,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1008.7733716791149" y="908.4383521360003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS may return the access token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 995.3701279457816 912.4593252560002 L 1035.5798591457817 912.4593252560002 L 1035.5798591457817 925.5274878960001 L 1003.646630951115 925.5274878960001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(995.3701279457816,925.5274878960001) translate(-995.3701279457816,-925.5274878960001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1003.747155279115 921.3389742293334 L 995.3701279457816 925.5274878960001 L 1003.747155279115 929.7160015626669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="649.3709781081254" y="940.6061370960002" width="184.64906113882813" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="650.8788430281254" y="949.6533266160003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. access token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 995.3701279457816 953.6742997360002 L 496.29739241463056 953.6742997360002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(488.02088940929724,953.6742997360002) translate(-488.02088940929724,-953.6742997360002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 496.39791674263057 949.4857860693335 L 488.02088940929724 953.6742997360002 L 496.39791674263057 957.8628134026669 Z"/></g></g><g><g><rect fill="white" stroke="none" x="499.9162682226306" y="968.7529489360003" width="282.83241074820313" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="499.9162682226306" y="978.8053817360003" width="206.9657267882422" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="501.4241331426306" y="977.8001384560004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. verifies the access token introspection response, if true,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="501.4241331426306" y="987.8525712560004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   the RS may return the protected resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 488.02088940929724 991.8735443760003 L 528.2306206092973 991.8735443760003 L 528.2306206092973 1004.9417070160002 L 496.29739241463056 1004.9417070160002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(488.02088940929724,1004.9417070160002) translate(-488.02088940929724,-1004.9417070160002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 496.39791674263057 1000.7531933493335 L 488.02088940929724 1004.9417070160002 L 496.39791674263057 1009.130220682667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="204.12329900026728" y="1020.0203562160003" width="109.19906419058594" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="205.63116392026728" y="1029.0675457360003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">21. protected resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 488.02088940929724 1033.0885188560003 L 37.701275787156575 1033.0885188560003" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(29.42477278182324,1033.0885188560003) translate(-29.42477278182324,-1033.0885188560003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 37.801800115156574 1028.9000051893336 L 29.42477278182324 1033.0885188560003 L 37.801800115156574 1037.277032522667 Z"/></g></g></g></g></svg>